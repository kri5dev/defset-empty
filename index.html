<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Defset — Coming soon</title>
    <meta name="description" content="Defset — Coming soon" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.svg" />
    <meta name="theme-color" content="#121212" />
    <style>
      :root { --bg: #111111; --fg: #e5e5e5; --muted: #9ca3af; --pad: clamp(12px, 3vw, 24px); }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0; background: var(--bg); color: var(--fg);
        font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
      }
      .frame { position: fixed; inset: 0; padding: var(--pad); padding-bottom: calc(var(--pad) + env(safe-area-inset-bottom)); padding-top: calc(var(--pad) + env(safe-area-inset-top)); display: grid; grid-template-rows: auto 1fr auto; }
      .top { font-size: 12px; letter-spacing: 0.02em; color: var(--muted); display: flex; align-items: center; }
      .center { display: grid; place-items: center; min-height: 0; min-width: 0; }
      pre#ascii { margin: 0; line-height: 1; font-size: 12px; color: #e5e5e5; white-space: pre; text-align: center; opacity: .95; display: inline-block; overflow: hidden; }
      .bottom { display: flex; justify-content: space-between; align-items: end; color: var(--muted); font-size: 12px; }
      a { color: var(--fg); text-decoration: none; border-bottom: 1px dotted #4b5563; padding-bottom: 1px; }
      a:hover { color: #ffffff; border-bottom-color: #9ca3af; }
      @media (max-width: 640px) {
        pre#ascii { font-size: 12px; }
      }
    </style>
  </head>
  <body>
    <div class="frame">
      <div class="top">Coming soon</div>
      <div class="center">
        <pre id="ascii" aria-label="Defset ASCII art">Loading…</pre>
      </div>
      <div class="bottom">
        <div>© <span id="year"></span> Defset</div>
        <div><a href="mailto:kristaps@defset.eu">Contact</a></div>
      </div>
    </div>
    <script>
      const yearEl = document.getElementById('year');
      yearEl.textContent = new Date().getFullYear();
      const asciiEl = document.getElementById('ascii');
      let asciiText = '';

      function fitAsciiToViewport() {
        if (!asciiText) return;
        const container = document.querySelector('.center');
        const maxW = container.clientWidth;
        const maxH = container.clientHeight;
        if (!maxW || !maxH) return;

        let lo = 6, hi = 240; // px
        for (let i = 0; i < 12; i++) {
          const mid = (lo + hi) / 2;
          asciiEl.style.fontSize = mid + 'px';
          const rect = asciiEl.getBoundingClientRect();
          if (rect.width <= maxW * 0.98 && rect.height <= maxH * 0.98) {
            lo = mid;
          } else {
            hi = mid;
          }
        }
        asciiEl.style.fontSize = lo + 'px';
      }

      const debouncedFit = (() => {
        let raf = 0;
        return () => {
          if (raf) cancelAnimationFrame(raf);
          raf = requestAnimationFrame(() => { raf = 0; fitAsciiToViewport(); });
        };
      })();

      fetch('ascii/defset.txt')
        .then(r => r.ok ? r.text() : Promise.reject(r.status))
        .then(text => {
          const normalized = text
            .replace(/\r/g, '')
            .split('\n')
            .map(line => line.replace(/\s+$/, '')) // trim trailing spaces per-line
            .join('\n')
            .replace(/\n+$/, '');
          asciiText = normalized;
          asciiEl.textContent = asciiText;
          (document.fonts && document.fonts.ready ? document.fonts.ready : Promise.resolve())
            .then(debouncedFit);
        })
        .catch(() => { asciiEl.textContent = 'Defset'; asciiText = 'Defset'; debouncedFit(); });

      window.addEventListener('resize', debouncedFit);
      window.addEventListener('orientationchange', debouncedFit);
    </script>
  </body>
  </html>


